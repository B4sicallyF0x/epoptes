From 754359d46c516a15a7989daac415c3517e66a3cf Mon Sep 17 00:00:00 2001
From: Vagrant Cascadian <vagrant@debian.org>
Date: Wed, 11 Jan 2017 14:01:56 -0800
Subject: [PATCH] Add support for tigervnc's xtigervncviewer binary.

---
 data/client-functions | 6 ++++--
 epoptes/ui/gui.py     | 3 +++
 2 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/data/client-functions b/data/client-functions
index b74b1e7..92a457f 100644
--- a/data/client-functions
+++ b/data/client-functions
@@ -344,6 +344,8 @@ receive_broadcast() {
         # If the user installed ssvnc, prefer it over xvnc4viewer
         if [ -x /usr/bin/ssvncviewer ]; then
             VNCVIEWER=ssvncviewer
+        elif [ -x /usr/bin/xtigervncviewer ]; then
+            VNCVIEWER=xtigervncviewer
         elif [ -x /usr/bin/xvnc4viewer ]; then
             VNCVIEWER=xvnc4viewer
         fi
@@ -353,8 +355,8 @@ receive_broadcast() {
         if [ "$VNCVIEWER" = "ssvncviewer" ]; then
             exec ssvncviewer -shared -viewonly -passwd /dev/stdin \
                 ${3:+-fullscreen} "$SERVER:$1"
-        elif [ "$VNCVIEWER" = "xvnc4viewer" ]; then
-            exec xvnc4viewer -Shared -ViewOnly -passwd /dev/stdin \
+        elif [ "$VNCVIEWER" = "xvnc4viewer" ] || [ "$VNCVIEWER" = "xtigervncviewer" ]; then
+            exec ${VNCVIEWER} -Shared -ViewOnly -passwd /dev/stdin \
                 ${3:+-FullScreen -UseLocalCursor=0 -MenuKey F13} "$SERVER:$1"
         else
             exec vncviewer -shared -viewonly -passwd /dev/stdin \
diff --git a/epoptes/ui/gui.py b/epoptes/ui/gui.py
index 1efb643..9ff7f46 100644
--- a/epoptes/ui/gui.py
+++ b/epoptes/ui/gui.py
@@ -268,6 +268,9 @@ class EpoptesGui(object):
             if os.path.isfile('/usr/bin/ssvncviewer'):
                 self.vncviewer = subprocess.Popen(['ssvncviewer',
                     '-multilisten', str(self.vncviewerport-5500)])
+            elif os.path.isfile('/usr/bin/xtigervncviewer'):
+                self.vncviewer = subprocess.Popen(['xtigervncviewer',
+                    '-listen', str(self.vncviewerport)])
             elif os.path.isfile('/usr/bin/xvnc4viewer'):
                 self.vncviewer = subprocess.Popen(['xvnc4viewer',
                     '-listen', str(self.vncviewerport)])
-- 
2.11.0

